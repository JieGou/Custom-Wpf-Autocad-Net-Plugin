function templateCompileController(n,t){var r={Name:'<span class="input-group-btn"><a href="#" id="markerTypeDropdownMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><button class="btn btn-default mapit-content-control-dropdown" type="button"><span>{{selectedItem.name}}<\/span><span class="caret"><\/span><\/button><\/a><ul class="dropdown-menu" aria-labelledby="markerTypeDropdownMenu"><li ng-repeat="markerFilter in markerFilters"><a ng-click="dropboxitemselected(markerFilter)">{{markerFilter.name}}<\/a><\/li><li role="separator" class="divider"><\/li><li><a href="#" ng-click="dropboxitemselected()">Adress<\/a><\/li><\/ul><\/span>',Name2:"<input type='text' class='form-control mapit-content-control-searchrun' ng-model='inputText' placeholder='Search markers...'>","X,Y":"<input type='text' style='width:45%' class='form-control mapit-content-control-searchrun' ng-model='inputTextX' placeholder='coordx...'><input type='text' style='width:45%' class='form-control mapit-content-control-searchrun' ng-model='inputTextY' placeholder='coordy...'>"}[n.searchFilterSelected?n.searchFilterSelected.name:n.$parent.searchFilterSelected.name],i=$("page");i.html("");i.append(t(r)(n))}function mapitController(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){function ht(n){return'<a href="#">'+n+'<em style="background:'+n+'; width:14px;height:14px;float:right"><\/em><\/a>'}var p=this,rt,b,k,d,g,nt,ft,et,ot,tt,it;p.$onInit=function(){var n=document.createElement("script");n.type="text/javascript";n.src="https://maps.googleapis.com/maps/api/js?v=3&key=[KEY]&libraries=geometry,places&callback=initialize";document.body.appendChild(n);$(".leaflet-top").css("margin-top","5px");$(".leaflet-control-attribution").css("opacity","0.2").css("font-size","9px");L.LayerGroup.include({getLayersByType:function(n){var t=[];return this.eachLayer(function(i){i instanceof n&&t.push(i)}),new L.LayerGroup(t)},getDistance:function(){var i=0,t=this.getLayersByType(L.Marker),n;if(t.getLayers().length>1){for(n=1;n<t.getLayers().length;n++)i+=t.getLayers()[n-1]._latlng.distanceTo(t.getLayers()[n]._latlng);return i.toFixed(2)}return i}});app.ruleGroup=new L.LayerGroup([]);app.favorGroup=new L.LayerGroup([]);app.flagGroup=new L.LayerGroup([])};p.$onChanges=function(){function n(t,i){window[t]?i():setTimeout(function(){n(t,i)},100)}n("google",function(){app.streetView.load();$("img[src*='google_white5']").css("background","none").css("opacity","0.2");window.onresize=function(){setTimeout(function(){app.streetView.refresh();var n=$(window).width();$("#linesCount").css("display",n<670?"none":"inline-block");$("#markersCount").css("display",n<670?"none":"inline-block")},20)}})};p.greetAll=function(){p.signalRService.sendRequest()};rt=0;app.dynamiclayers={};app.dynamiclayers.businessLinesLayer=L.geoJSON([],{pane:"pane250",onEachFeature:function(n,t){t.defaultOptions.style.color=n.properties.color},pointToLayer:function(){},style:{stroke:"green","stroke-dasharray":"10,10","stroke-width":"5",color:"#34ffd0",weight:4,opacity:.5}});app.dynamiclayers.businessMarkerLayer=L.geoJSON([],{pane:"pane450",onEachFeature:function(n,t){var i={maxWidth:300,autoClose:!0,closeOnClick:!1,id:n.id};n.properties.data.Leaflet_id=t._leaflet_id;t.options.data=n.properties.data;t.options.entityType="circleMarker";t.options._isFavorite=!1;n.properties.popupContent=app.getMarkerTemplate(t);t.bindPopup(n.properties.popupContent,i);t.closeButtonHandler=function(){t._popup.options.autoClose=!0;t.setStyle(y.markerStyleDefault);t.closePopup()};t.on("click",function(n){var t=n.target;t.isActive=!0;t._popup.options.autoClose=!1;t.setStyle({fillColor:"yellow"});app.addMarkerEventClickHandler(t);t.fireEvent("popupopen")});t.on("popupopen",function(n){var t=n.target,i,r;t.options._isFavorite&&(i=document.getElementById(t.options.entityType+t._leaflet_id),i&&(r=$(i).find('input[id ^= "favoriteChk"]')[0],r&&(r.checked=!0)));t._popup._closeButton.addEventListener("click",t.closeButtonHandler,!1)});t.on("popupclose",function(n){var t=n.target;t._popup._closeButton.removeEventListener("click",t.closeButtonHandler,!0)});t.on("mouseover",function(n){t.setStyle({fillColor:"yellow"});t._popup.options.autoClose&&(t._popup.options.isWaitToStart=!0,setTimeout(function(){t._popup.options.isWaitToStart&&t.openPopup([n.latlng.lat+1e-5,n.latlng.lng+1e-5])},500))});t.on("mouseout",function(){t._popup.options.isWaitToStart=!1;t._popup.options.autoClose&&(t.setStyle(y.markerStyleDefault),t.closePopup())})},pointToLayer:function(n,t){var i;try{i=L.circleMarker(t,y.markerStyleDefault).addTo(map);rt++}catch(r){return null}}});app.dynamiclayers.businessPointLayer=L.geoJSON([],{pane:"pane450",onEachFeature:function(n,t){var i={maxWidth:300,autoClose:!0,closeOnClick:!1,id:n.id};n.properties.data.Leaflet_id=t._leaflet_id;t.options.data=n.properties.data;t.options.entityType="circleMarker";t.options._isFavorite=!1;n.properties.popupContent=app.getMarkerTemplate(t);t.bindPopup(n.properties.popupContent,i);t.closeButtonHandler=function(){t._popup.options.autoClose=!0;t.setStyle(y.markerStyleDefault);t.closePopup()};t.on("click",function(n){var t=n.target;t.isActive=!0;t._popup.options.autoClose=!1;t.setStyle({fillColor:"yellow"});app.addMarkerEventClickHandler(t);t.fireEvent("popupopen")});t.on("popupopen",function(n){var t=n.target,i,r;t.options._isFavorite&&(i=document.getElementById(t.options.entityType+t._leaflet_id),i&&(r=$(i).find('input[id ^= "favoriteChk"]')[0],r&&(r.checked=!0)));t._popup._closeButton.addEventListener("click",t.closeButtonHandler,!1)});t.on("popupclose",function(n){var t=n.target;t._popup._closeButton.removeEventListener("click",t.closeButtonHandler,!0)});t.on("mouseover",function(n){t.setStyle({fillColor:"yellow"});t._popup.options.autoClose&&(t._popup.options.isWaitToStart=!0,setTimeout(function(){t._popup.options.isWaitToStart&&t.openPopup([n.latlng.lat+1e-5,n.latlng.lng+1e-5])},500))});t.on("mouseout",function(){t._popup.options.isWaitToStart=!1;t._popup.options.autoClose&&(t.setStyle(y.markerStyleDefault),t.closePopup())})},pointToLayer:function(n,t){return L.circleMarker(t,y.markerStyleDefault).addTo(map)}});app.dynamiclayers.drawnItems=new L.FeatureGroup;var vt=v.search(),ut=s.defer(),st=ut.promise;p.$scope=f;p.stringFormat=l("stringFormat");p.connected=!0;p.isAcadOwner=!1;p.currentMarker={};p.places=[];p.signalRService=r;app.ruleGroup=undefined;app.favorGroup=undefined;app.flagGroup=undefined;app.progressBar_kav=n.create("progressLines","progress-lines",.1);app.progressBar_kav.displayTo(50);app.progressBar_gov=n.create("progressMarkers","progress-markers",.1);app.progressBar_gov.displayTo(50);p.signalRService.initialize(p,function(n){p.connected=n});b=new L.LatLng(32.0662,34.7778);localStorage?(p.zoom=localStorage.getItem("zoom_last")||15,k=JSON.parse(localStorage.getItem("center"))||{lat:32.0662,lng:34.7778},b=new L.LatLng(k.lat,k.lng)):p.zoom=15;map&&map.remove();map=L.map("mapit",{center:b,zoom:p.zoom,zoomControl:!1,tileSize:128,test:function(){return Math.random()}});map.createPane("pane250").style.zIndex=250;map.createPane("pane450").style.zIndex=450;d=L.control.angular({position:"topleft",template:'<div><span style="left: 15px;"><img id="logo" src="mapit/images/logo32.png" /><a style="color: white; font-weight: bold; text-shadow: 2px 2px 2px rgba(0, 0, 0, 0.7)" href="#">MapIT<\/a><\/span><span class="dropdown"><a href="#" id="dropdownMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><span> <\/span><span class="caret"><\/span><\/a><ul class="dropdown-menu" aria-labelledby="dropdownMenu" style="margin-top: -25px; margin-left: 40px"><li data-match-route="/vertical"><a href="/mapit/vertical">vertical<\/a><\/li><li data-match-route="/horizontal"><a href="/mapit/horizontal">horizontal<\/a><\/li><li class="divider"><\/li><li data-match-route="/reset"><a href="/mapit/reset">reset<\/a><\/li><\/ul><\/span><\/div>',controller:["$scope","config",function(){}]});map.addControl(d);g=L.Control.loading({spinjs:!0,position:"topleft",zoomControl:d});map.addControl(g);nt=$(g.getContainer()).find(".spinner")[0];nt.style.left="22px";nt.style.top="3px";ft=new L.Control.Search({position:"topleft",layerGroup:app.dynamiclayers.businessPointLayer,buildTip:ht,autoType:!1,controller:["$compile","$rootScope","$scope","$filter","config",function(){}]});map.addControl(ft);y.layers.openStreetMap.on("loading",function(n){map.fireEvent("dataloading",n)}).on("tileload",function(n){map.fireEvent("dataload",n);ut.resolve()});map.addLayer(y.layers.openStreetMap);f.$on("$stateChangeSuccess",function(){});var ct={OpenStreets:y.layers.openStreetMap,OpenStreetMap_BlackAndWhite:y.layers.openStreetMap_BlackAndWhite,GoogleStreets:y.layers.googleStreets,GoogleHybrid:y.layers.googleHybrid,GoogleSat:y.layers.googleSat,GoogleTerrain:y.layers.googleTerrain,EsriWorldImagery:y.layers.esriWorldImagery},lt={DrawnItems:app.dynamiclayers.drawnItems},at=L.control.layers(ct,lt,{position:"topleft"});map.addControl(at);et=L.control.zoom({position:"topleft"});map.addControl(et);map.addLayer(app.dynamiclayers.drawnItems);ot=new L.Control.Draw({position:"topleft",draw:{polyline:{guidelineDistance:10,allowIntersection:!1,shapeOptions:{color:"red",weight:5,opacity:.7,metric:!0},showLength:!0},polygon:{allowIntersection:!1,drawError:{color:"#e1e100",message:"<strong>Oh snap!<strong> you can't draw that!"},shapeOptions:{color:"#bada55"}},circle:!0,circlemarker:$.extend({},y.markerStyleDefault,{fillColor:"orange",color:"red",radius:5}),rectangle:!1,marker:{icon:app.config.flagIcon}},edit:{featureGroup:app.dynamiclayers.drawnItems,poly:{allowIntersection:!1},remove:!0}});map.addControl(ot);L.control.scale({position:"bottomright"}).addTo(map);tt=function(n){var r=function(n,t){return Math.round(n*Math.pow(10,t))/Math.pow(10,t)},f=function(n){return"("+r(n.lat,6)+", "+r(n.lng,6)+")"},e,o,s,t,u,i;if(n instanceof L.Marker||n instanceof L.CircleMarker)return f(n.getLatLng());if(n instanceof L.Circle)return e=n.getLatLng(),o=n.getRadius(),"Center: "+f(e)+"<br />Radius: "+r(o,2)+" m";if(n instanceof L.Polygon)return t=n._defaultShape?n._defaultShape():n.getLatLngs(),s=L.GeometryUtil.geodesicArea(t),"Area: "+L.GeometryUtil.readableArea(s,!0);if(n instanceof L.Polyline){if(t=n._defaultShape?n._defaultShape():n.getLatLngs(),u=0,t.length<2)return"Distance: N/A";for(i=0;i<t.length-1;i++)u+=t[i].distanceTo(t[i+1]);return"Distance: "+r(u,2)+" m"}return null};map.on(L.Draw.Event.CREATED,function(n){var r=n.layerType,t=n.layer,i;r==="marker"?(t.options.entityType="tempMarker",map.createGeocoderPopup(t,function(){})):(i=tt(t),i!==null&&t.bindPopup(i));app.dynamiclayers.drawnItems.addLayer(t)});map.on(L.Draw.Event.EDITED,function(n){var i=n.layers,t=null;i.eachLayer(function(n){t=tt(n);t!==null&&n.setPopupContent(t)})});map.on(L.Draw.Event.DELETED,function(n){var t=n.layer;app.dynamiclayers.drawnItems.removeLayer(t)});map.createGeocoderPopup=function(n){var t,i;if(n instanceof L.Layer)t=n,i=n._latlng;else if(n instanceof L.LatLng)i=n;else return!1;app.geocoders.google.reverse(i,map.options.crs.scale(map.getZoom()),function(n){var r,u,f;if(n.length!==0)if(r=L.popup({autoClose:!1,entityType:"tempMarker"}),u=JSITM.gps2itm(new JSITM.LatLng(i.lat,i.lng)),t.options.data={CoordX:0,CoordY:0,ElementName:"",ElementType:"",FileName:"",FolderName:"",Id:-1,Leaflet_id:r._leaflet_id,Lat:i.lat,Lng:i.lng,Latitude:u.x,Longitude:u.y,clientName:"client",content:n[0].html||n[0].name},r.options.autoClose=!1,t){f=app.getMarkerTemplate(t,t.options.data.content);r.setContent(f);t.bindPopup(r);t.addTo(map);t.on("click",function(n){var t=n.target;t._popup.openPopup()});t.on("popupopen",function(n){var t=n.target;setTimeout(function(){app.addMarkerEventClickHandler(t)},200)});setTimeout(function(){t.fireEvent("click")},200)}else r.setLatLng(new L.LatLng(i.lat,i.lng)),r.openPopup(),setTimeout(function(){app.addMarkerEventClickHandler(r)},200)})};map.dataloaded=function(){var i=JSON.parse(localStorage.getItem("favorite_markers")),n,t,r;i&&i.length>0&&(n=i[i.length-1],t=undefined,n.circleMarker?(t=l("filterMarker")("ElementName",n.circleMarker.ElementName),t.options._isFavorite=!0,r=n.circleMarker.Zoom):n.tempMarker&&(t=n.tempMarker.Latlng,r=n.tempMarker.Zoom),app.displayPopup(t,r||15))};map.on("click",function(){});map.on("layeradd1",function(n){if(n.layer.options&&(n.layer.options.id==="markerLayer1"||n.layer.options.id==="markerLayer2")){var t=n.layer.getLayers(),i=$("#mySelector");t.sort(function(n,t){var i=parseInt(n.feature.properties.id,10),r=parseInt(t.feature.properties.id,10);return i<r?-1:i>r?1:0}).forEach(function(n){i.append("<option value='"+L.stamp(n)+"'>"+n.feature.properties.id+". "+n.feature.properties.name+"<\/option>")})}});map.on("layerremove1",function(n){var i,r,t;if(n.layer.options&&(n.layer.options.id==="markerLayer1"||n.layer.options.id==="markerLayer2"))for(i=n.layer.getLayers(),r=$("#mySelector"),t=0;t<i.length;t++)r.find("option[value='"+L.stamp(i[t])+"']").remove()});map.on("zoomstart",function(){});map.on("zoomend",function(){if(localStorage){localStorage.setItem("zoom_last",map.getZoom());var n=map.getBounds().getCenter();localStorage.setItem("center",JSON.stringify({lat:n.lat,lng:n.lng}))}});map.on("moveend",function(){if(app.dynamiclayers.businessPointLayer.placeInBoundsByZoom(5),app.dynamiclayers.businessLinesLayer.placeInBoundsByZoom(13),localStorage){var n=map.getBounds().getCenter();localStorage.setItem("center",JSON.stringify({lat:n.lat,lng:n.lng}))}});it=function(n){for(var f,e=map.getBounds(),u=this.getLayers(),i=[],r=u.length-1;r>=0;r--){var t=u[r],o=t.feature.geometry.type==="LineString"?t.getLatLngs()[0]:t.getLatLng(),s=e.contains(o)&&map.getZoom()>(n||14);s?i.push(t):map.removeLayer(t)}i.length>0&&(f=L.featureGroup(i).addTo(map),f.bringToBack())};app.dynamiclayers.businessPointLayer.placeInBoundsByZoom=it;app.dynamiclayers.businessLinesLayer.placeInBoundsByZoom=it;p.onPopupClose=function(n){var t=n._popup,r=function(n){var t=n.currentTarget.parentElement.querySelector('[id^="marker"]').id.replace("marker","")},i;$(t._container).find(".my-popup-content").attr("tabindex","-1").focus();i=$(t._container).find(".mapit-popup-close-button");$(t._container).find(".mapit-popup-close-button").remove();i.attr("title","Close marker");$(t._container).append(i)};p.addCurrentLocationToMap=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){var t=n.coords.latitude,i=n.coords.longitude,r=L.Marker([t,i])})};app.getGeoDataMarkers=function(n){var t=[];return n.features.forEach(function(n){t.push(app.getGeoDataMarker(n))}),t};app.getGeoDataMarker=function(n,t){var i=JSON.parse(n.properties.entityValue),r=JSITM.itm2gps({x:parseFloat(i.longitude),y:parseFloat(i.latitude)});return n.Lng=r.lng,n.Lat=r.lat,n.Latitude=parseFloat(i.latitude),n.Longitude=parseFloat(i.longitude),n.ElementName=i.data_search||"",n.FolderName=i.as_made_nu||"",n.FileName=i.shem_autoc||"",n.clientName=t,{type:"Feature",geometry:{type:"Point",coordinates:[n.Lng.toFixed(5),n.Lat.toFixed(5)]},properties:{popupContent:[],data:n}}};app.getGeoPoints=function(n){var t=[];return n.forEach(function(n){t.push(app.getGeoPoint(n))}),t};app.getGeoPoint=function(n,t){var i={lng:n.Longitude,lat:n.Latitude};return(n.Longitude>35||n.Latitude>31)&&(i=JSITM.itm2gps({x:parseFloat(n.Latitude),y:parseFloat(n.Longitude)})),n.Lng=i.lng,n.Lat=i.lat,n.clientName=t,{type:"Feature",geometry:{type:"Point",coordinates:[n.Lng.toFixed(5),n.Lat.toFixed(5)]},properties:{popupContent:[],data:n}}};p.getGeoLines=function(n){var t=[],i;return n.forEach(function(n){var i=[],r;n.geometry.coordinates.forEach(function(n){i.push(new L.LatLng(n[0],n[1]))});r=L.polyline(i,{color:"yellow",weight:3,opacity:.65,smoothFactor:1,entityType:"polyline"}).addTo(map);t.push(r)}),i={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[[30.0662,30.7778],[30.56756,35.5675],[35.4334,36.56756],[35.78978,36.56934309756]]},properties:{popupContent:"This is free bus that will take you across downtown.",underConstruction:!1},id:1}]},t};p.onInit=function(){var n=L.divIcon({html:'<div style="border: 2px solid blue; border-radius:50%; background: white; width:100%; height:100%"><\/div>',iconSize:[20,20]}),i=L.marker(latlng,{icon:n}),t;this.MyControl=L.Control.extend({options:{position:"topright"},onAdd:function(){return L.DomUtil.create("div","my-custom-control")}});this.MyClass=L.Class.extend({initialize:function(n){this.greeter=n},greet:function(n){alert(this.greeter+", "+n)}});t=new this.MyClass("Hello")};p.fileOpen=function(n){alert(n)};app.sendToServer=function(n,t){var r=i.create(t),u;if(r.show(3e3),!p.signalRService.chat){r.error(2e3,"signalRService.chat not found","red");return}u=function(n,t){p.signalRService.chat.server[n](t.options.data).done(function(){r.show(1e3,"green");console.log("sendToServer> "+n+" done")}).fail(function(t){r.error(3e3,"red");console.log("sendToServer> "+n+" error: "+t)});var i=n.replace("sendTo","on");p.signalRService.chat.client[i]=function(){r.hide();console.log("sendToServer> retrieve "+i+" done")}};$.connection.hub.lastError?$.connection.hub.start().done(function(){u(n,t)}).fail(function(n){console.error("Invocation of start failed. Error:"+n)}):u(n,t)};p.googlePanTo=function(n){map.panTo([n[0].geometry.location.lat(),n[0].geometry.location.lng()])};p.panToCenter=function(){var n=map.getSize().divideBy(2),i=n.subtract([2,0]),t=map.containerPointToLatLng(n);map.panTo(t)};p.panBy=function(){var n=map.getSize().x*.15;map.panBy(new L.Point(-n,0),{animate:!1})};p.googleFitBounds=function(n){map.fitBounds([[n[0].geometry.viewport.getSouthWest().lat(),n[0].geometry.viewport.getSouthWest().lng()],[n[0].geometry.viewport.getNorthEast().lat(),n[0].geometry.viewport.getNorthEast().lng()]])};p.clicked=function(n){alert("ev: "+n);alert("ev-data: "+n.target.attributes.data.value)};s.all([st]).then(function(){map.invalidateSize(!0);app.streetView.load();o(function(){t.get(y.markersApiUrl).then(function(n){u.markersCount=n.length;app.dynamiclayers.businessPointLayer.addData(n);app.dynamiclayers.businessPointLayer.placeInBoundsByZoom(5);app.progressBar_gov.displayTo(100)})},300);o(function(){t.get(y.linesApiUrl).then(function(n){app.dynamiclayers.businessLinesLayer.addData(n.features);app.dynamiclayers.businessLinesLayer.placeInBoundsByZoom(14);app.progressBar_kav.displayTo(100);o(function(){map.dataloaded()},200)})},400)})}var app=angular.module("mapIt",["shagstrom.angular-split-pane","ngRoute"]).constant("config",{baseWebApiUrl:"http://vmmapinfo/mapitapi/api/",baseAcadHostUrl:"http://Intellidesk/acadapi/",markersApiUrl:"Markers",linesApiUrl:"Lines",hubUrl:"http://localhost:8080/signalr",findFileServiceUrl:"Find/File?fullPath={0}&fileName={1}&referer={2}",tileUrl:"https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw",tileUrlMapbox:"https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw",geoJsonUrl:"https://gist.githubusercontent.com/anonymous/264fdd9de2f41d2536de/raw/2c35bf05677071d27dca2c8f94b89287dc24ed06/test.geojson",layerOption:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",tileAttr:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap<\/a> | <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA<\/a> | Imagery <a href="http://mapbox.com">Mapbox<\/a>',markerStyleDefault:{radius:5,fillColor:"#ff6347",color:"#000",weight:2,opacity:.5,fillOpacity:.8,pane:"pane250"},redIcon:new L.Icon({iconUrl:"/lib/leaflet/images/marker-icon-red.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),baseballIcon:L.icon({iconUrl:"http://leafletjs.com/examples/geojson/baseball-marker.png",iconSize:[32,37],iconAnchor:[16,37],popupAnchor:[0,-28]}),flagIcon:L.icon({iconUrl:"mapit/images/flag-icon.png",iconSize:[33,36],iconAnchor:[0,36],popupAnchor:[0,-36]}),layers:{openStreetMap:L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="htp://osm.org/copyright">OpenStreetMap<\/a> contributors'}),openStreetMap_DE:L.tileLayer("http://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png",{maxZoom:25,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap<\/a>'}),openStreetMap_BlackAndWhite:L.tileLayer("http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png",{maxZoom:25,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap<\/a>'}),googleStreets:L.tileLayer("http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",{maxZoom:25,subdomains:["mt0","mt1","mt2","mt3"]}),googleHybrid:L.tileLayer("http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}",{maxZoom:25,subdomains:["mt0","mt1","mt2","mt3"]}),googleSat:L.tileLayer("http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{maxZoom:25,subdomains:["mt0","mt1","mt2","mt3"]}),googleTerrain:L.tileLayer("http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}",{maxZoom:25,subdomains:["mt0","mt1","mt2","mt3"]}),esriWorldImagery:L.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}),esriWorldImagery2:L.tileLayer("http://resources.esri.com/help/9.3/arcgisserver/apis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"})}}).config(["$routeProvider","$locationProvider",function(n,t){n.when("/mapit/vertical",{templateUrl:"/mapit/templates/mapit_vertical.html",controller:"verticalCtrl"}).when("/mapit/horizontal",{templateUrl:"/mapit/templates/mapit_horizontal.html",controller:"horizontalCtrl"}).when("/mapit/reset",{templateUrl:"/mapit/templates/mapit_horizontal.html",controller:"resetCtrl"}).when("/mapit/test",{template:'<mapitmain-component style="width: 100%">Loading...<\/mapitmain-component>',controller:"testCtrl"}).otherwise({redirectTo:"/mapit/vertical"}).otherwise({template:"<h1>Not Found<\/h1>"});t.html5Mode({enabled:!0,requireBase:!1})}]).controller("mainCtrl",["$scope","$location","$rootScope","$filter",function(){}]).controller("verticalCtrl",["$scope","$location",function(){}]).controller("horizontalCtrl",["$scope","$location",function(){}]).controller("resetCtrl",["$scope","$location","$window",function(){}]),map,gmap;app.geocoders=undefined;app.progressBarMarkers=undefined;app.progressBarLines=undefined;app.markersData=undefined;app.value("$",$);app.run(["$http","$location","$rootScope","config",function(n,t,i,r){app.config=r;$(document).ready(function(){});r.markersApiUrl=r.baseWebApiUrl+r.markersApiUrl;r.linesApiUrl=r.baseWebApiUrl+r.linesApiUrl;r.findFileServiceUrl=r.baseAcadHostUrl+r.findFileServiceUrl;n.defaults.headers.common["Access-Control-Allow-Origin"]="*";n.defaults.headers.post.dataType="json";n.defaults.useXDomain=!0;n.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";n.defaults.headers.post["Access-Control-Allow-Origin"]="*";delete n.defaults.headers.common["X-Requested-With"];i.$on("$routeChangeStart",function(n,i,r){var u="vertical";r||!i||i.$$route?t.path().indexOf("horizontal")>0?localStorage&&localStorage.setItem("orient","horizontal"):t.path().indexOf("vertical")>0?localStorage&&localStorage.setItem("orient","vertical"):t.path().indexOf("reset")>0&&(localStorage&&(localStorage.setItem("favorite_markers",JSON.stringify([])),localStorage.setItem("zoom_last",15),localStorage.setItem("center",JSON.stringify({lat:32.0662,lng:34.7778})),u=localStorage.getItem("orient")||u),t.path("/mapit/"+u),window.location.href="http://vmmapinfo/mapit/mapit.html"):(u=localStorage&&localStorage.getItem("orient")!=null?localStorage.getItem("orient"):"vertical",n.preventDefault(),t.path("/mapit/"+u))})}]);app.component("mapitComponent",{bindings:{type:"="},template:"",controller:["progressBar","dataService","loaderService","signalRService","$rootScope","$scope","$http","$timeout","$q","$compile","$templateCache","$filter","$window","$location","config",mapitController]});app.service("dataService",["$http","$q",function(n,t){this.get=function(i){var r=t.defer(),u;try{u=JSON.parse(null)}catch(f){u=null}return u?r.resolve(u):u===null&&(i.indexOf("Markers")>0||i.indexOf("Lines")>0)?(n({url:i,dataType:"json",method:"GET",withCredentials:!0,headers:{"Content-Type":"application/json; charset=utf-8",mapit:"2017"}}).then(function(n){i.indexOf("Markers")>0&&(n.data=app.getGeoDataMarkers(n.data));r.resolve(n.data)}),function(){r.resolve(undefined)}):u===null&&i.indexOf("App_Resource")>0&&n({method:"GET",url:i}).then(function(n){r.resolve(n.data)},function(){r.resolve(undefined)}),r.promise}}]);app.factory("TempService",function(){return this.message="Please click on the map!",this});app.service("signalRService",["$","$rootScope","$q","$filter","config",function(n,t,i,r,u){this.chat=null;this.acadHubProxy=null;this.initialize=function(t,i){var f=r("stringFormat");(n.connection.hub.logging=!0,n.connection.hub.url=u.hubUrl,this.chat=n.connection.acadMapHub,this.chat)&&(this.chat.client.setView=function(){map.setView(new L.LatLng(32.0662,34.7778),20)},this.chat.client.onMessage=function(n){i(n)},this.chat.client.onAcadPass=function(t){var e=n.parseJSON(t),i,f,o;switch(e.CommandName){case"PointOnMap":o=app.getGeoPoint(e.CommandArgs,e.ClientGroup);f=angular.copy(o.properties.data);break;case"FindtextOnMap":if(i=r("filterMarker")("ElementName",e.CommandArgs.text),i)f=i.feature.properties.data;else return alert("Command FindtextOnMap: text '"+e.CommandArgs.text+"' not found on map!"),!1;break;default:return!1}i=L.marker(new L.LatLng(f.Lat,f.Lng),{icon:u.flagIcon,entityType:"acadMarker",data:f,controls:app.flagGroup}).addTo(map);i.bindPopup(app.getMarkerTemplate(i)).addTo(map).openPopup();i.closeButtonHandler=function(){i._popup.options.autoClose=!0;i.closePopup()};i.on("popupopen",function(n){var t=n.target;app.addMarkerEventClickHandler(t);t._popup._closeButton.addEventListener("click",t.closeButtonHandler,!1)});i.on("popupclose",function(n){var t=n.target;t._popup._closeButton.removeEventListener("click",t.closeButtonHandler,!0)});app.flagGroup.addLayer(i);app.addMarkerEventClickHandler(i);map.setView(new L.LatLng(f.Lat,f.Lng),20)},n.connection.hub.stateChanged(function(t){t.newState===n.connection.connectionState.reconnecting&&n.connection.hub.stop()}),n.connection.hub.disconnected(function(){n.connection.hub.lastError?(n("#connect").css("opacity","0.2"),console.log("Disconnected. Reason: "+n.connection.hub.lastError.message)):setTimeout(function(){n.connection.hub.start();n("#connect").css("opacity","1")},5e3)}),setTimeout(function(){n.connection.hub.qs={"intellidesk-clienttype":"mapit"};n.connection.hub.start().done(function(){}).fail(function(n){console.log(n)})},2e3))};this.init=function(i){var r=n.hubConnection();r.disconnected(function(){setTimeout(function(){r.start()},5e3)});this.acadHubProxy=r.createHubProxy("acadMapHub");this.acadHubProxy.on("onAcadMessage",function(n){t.$apply(function(){i(n)})});this.acadHubProxy.on("onAcadPass",function(n){t.$apply(function(){L.popup().setLatLng(new L.LatLng(n.CommandArgs.Lat,n.CommandArgs.Lng)).setContent("Point from acad").openOn(map)})})};this.sendRequest=function(){this.acadHubProxy.invoke("greetAll")};this.getAllNotesAsync=function(){var n=i.defer();return this.acadHubProxy.invoke("getAllNotes").done(function(t){n.resolve(t)}),n.promise}}]);app.factory("progressBar",["$","$timeout",function(n,t){return{create:function(i,r,u){var f=document.getElementById(i);return f.value=u,f.classList.add(r),{displayTo:function(i){n(this).animate({opacity:1,value:i},200);i>=100&&(this.value=i,t(function(){n(this).fadeOut(1e3)}.bind(this),200))}.bind(f)}}}}]);app.filter("stringPlaceFormat",[function(){return function(n,t){var u=t.split(","),r,i,f;if(arguments.length>2&&u.length>0){for(r=n,i=2;i<arguments.length;i++)f=new RegExp("\\{"+u[i-2]+"\\}"),r=r.replace(f,arguments[i]);return r}return n}}]);app.filter("stringFormat",[function(){return function(n){var i,t,r;if(arguments.length>1){for(i=n,t=1;t<arguments.length;t++)r=new RegExp("\\{"+(t-1)+"\\}"),i=i.replace(r,arguments[t]);return i}return n}}]);app.filter("filterMarker",["config",function(){return function(n,t){var i=undefined,r=app.dynamiclayers.businessPointLayer.getLayers();return r.length>0&&(n==="Id"&&typeof t=="number"?i=r.filter(function(n){var i=n.feature.properties.data;return i.Id===t?n:undefined}):n==="ElementName"&&typeof t=="string"?i=r.filter(function(n){var i=n.feature.properties.data;return i.ElementName.indexOf(t)>=0?n:undefined}):n==="File"&&typeof t=="string"?i=r.filter(function(n){var i=n.feature.properties.data;return i.FileName.indexOf(t)>=0?n:undefined}):n==="Folder"&&typeof t=="string"?i=r.filter(function(n){var i=n.feature.properties.data;return i.FolderName.indexOf(t)>=0?n:undefined}):n==="X,Y"&&Array.isArray(t)&&t.length===2?i=r.filter(function(n){var i=n.feature.properties.data;return i.Latitude===t[0]&&i.Longitude===t[1]?n:undefined}):n==="Lat,Lng"&&Array.isArray(t)&&t.length===2&&(i=r.filter(function(n){var i=n.feature.properties.data;return i.Lat.toFixed(5)===t[0]&&i.Lng.toFixed(5)===t[1]?n:undefined}))),i?i[0]:undefined}}]);app.service("loaderService",["$","$timeout",function(n,t){this.create=function(i){var f=document.getElementById(i.options.entityType+i._leaflet_id),r=f.getElementsByClassName("spinner")[0],u=!1;return{show:function(i,f){u=!1;n(r).find("i").removeClass("fa-exclamation-triangle").addClass("fa-refresh fa-spin");n(r).find("i").css("color","black");n(r).css("display","inline-block");t(function(){n(r).find("i").css("color",f||"black");i&&t(function(){u||n(r).css("display","none")},i)},i)},hide:function(i,u){u&&n(r).find("i").css("color","green");t(function(){n(r).css("display","none")},i||500)},error:function(i,f,e){u=!0;t(function(){n(r).find("i").removeClass("fa-refresh").removeClass("fa-spin").addClass("fa-exclamation-triangle");n(r).css("display","inline-block");n(r).attr("title",f);e&&n(r).find("i").css("color",e||"red");t(function(){n(r).fadeOut(3e3)},i||5e3)},i||5e3)}}}}]);app.geocoders={google:L.Control.Geocoder.google("AIzaSyA9BAT_ITgqlFpZNPxKw_ylCG-hLR00uAs",{language:"he"})};app.getTemplate=function(n){var t,i="<input type='text' class='form-control mapit-search' ng-model='inputText' placeholder='Search markers...'>";switch(n){case"name":t=i;break;case"folder":t=i;break;case"file":t=i;break;case"x,y":t=i;break;case"lat,lng":t=i}return t};app.getMarkerTemplate=function(n,t){var i=n.options.data||{},u,r;return n instanceof L.Marker?(u=new JSITM.LatLng(n._latlng.lat,n._latlng.lng),r=JSITM.gps2itm(u),i.Lat=n._latlng.lat,i.Lng=n._latlng.lng,i.Latitude=r.x,i.Longitude=r.y):n instanceof L.circleMarker,["<div class='mapit-marker' id='",n.options.entityType,n._leaflet_id,"' value=",n._leaflet_id,">","<div class='mapit-marker-bar'>",i.clientName&&i.clientName==="acad"?"A":"","<button type='button' class='mapit-icon mapit-pegman-icon btn btn-default'><\/button>","<input id='favoriteChk"+n._leaflet_id+"' type='checkbox' class='mapit-icon mapit-star-icon right checked' title='favorite' /><label for='favoriteChk"+n._leaflet_id+"' class='txticon right'><\/label>","<div class='mapit-icon spinner right' style='display:none; cursor: pointer'><i class='fa fa-refresh fa-spin fa-1x fa-fw'><\/i><\/div>","<\/div>",t||"","<input type='file' id='files' name='file' style='display:none'><\/input>",i.ElementName?"<div>name: <b><a class='mapit-title' href='#'>"+i.ElementName+"<\/a><\/b><\/div>":"",i.FolderName?"<div>folder: <b><a class='mapit-foldername' href='#'>"+i.FolderName+"<\/a><\/b><\/div>":"",i.clientName&&i.clientName==="acad"?"<div>file: <b class='mapit-filename'>"+i.FileName+"<\/b><\/<div>":i.FileName?"<div>file: <b class='mapit-filename'><a href='#'>"+i.FileName+"<\/a><\/b><\/<div>":"",i.ClientName?"<div>from: <b class='mapit-clientname'>"+i.ClientName+"<\/b><\/div>":"","<div>lat,lng: <b><a class='mapit-coords' href='#'>",i.Lat.toFixed(5),",",i.Lng.toFixed(5),"<\/a><\/b><div>","<div>x,y: <b><a class='mapit-coords-xy' href='#'>",i.Latitude.toFixed(5),",",i.Longitude.toFixed(5),"<\/a><\/b><div>",app.ruleGroup.getLayers().length>1?"distance: "+app.ruleGroup.getDistance():"","<\/div>"].join("")};app.addMarkerEventClickHandler=function(n){var t=document.getElementById(n.options.entityType+n._leaflet_id),i=t.getElementsByClassName("mapit-foldername")[0],r=t.getElementsByClassName("mapit-filename")[0],u=t.getElementsByClassName("mapit-coords")[0],f=t.getElementsByClassName("mapit-coords-xy")[0],o=t.getElementsByClassName("mapit-flag-icon")[0],s=t.getElementsByClassName("mapit-star-icon")[0],e=t.getElementsByClassName("mapit-pegman-icon")[0],h,c,l,a,v,y,p;e&&(h=function(){app.streetView.load(this._latlng)}.bind(n),e.removeEventListener("click",h),e.addEventListener("click",h),$._data(e,"events")===null&&(e.enable=!1));u&&(c=function(){app.sendToServer("sendToDisplayPoint",this)}.bind(n),u.removeEventListener("click",c),u.addEventListener("click",c),$._data(u,"events")===null&&(u.style.color="#cccccc"));f&&(l=function(){app.sendToServer("sendToDisplayPoint",this)}.bind(n),f.removeEventListener("click",l),f.addEventListener("click",l),$._data(f,"events")===null&&(f.style.color="#cccccc"));s&&(a=function(n){var t=this,i=JSON.parse(localStorage.getItem("favorite_markers"))||[],u,r;n.currentTarget.checked?(r={},t.feature&&t.feature.properties.data?r[t.options.entityType]={ElementName:t.feature.properties.data.ElementName,Zoom:map.getZoom()}:t._latlng&&(r[t.options.entityType]={Latlng:t._latlng,Zoom:map.getZoom()}),t.options._isFavorite=!0,i.push(r),app.favorGroup.addLayer(t)):(app.favorGroup.removeLayer(t),t.options._isFavorite=!1,i.length>0&&(u=undefined,i=i.filter(function(n){var i=n[t.options.entityType];switch(t.options.entityType){case"circleMarker":return i.ElementName!==t.feature.properties.data.ElementName;case"tempMarker":return i.lat!==t._latlng.lat&&i.lng!==t._latlng.lng}})));localStorage.setItem("favorite_markers",JSON.stringify(i))}.bind(n),s.removeEventListener("click",a),s.addEventListener("click",a));o&&(v=function(n){var t,r,i;if(n.currentTarget.checked){if(t=L.marker(this._latlng,{icon:app.config.flagIcon,entityType:"flagMarker",data:undefined,controls:new L.LayerGroup([])}).addTo(map),t.options.data=angular.extend(this.options.data,{Leaflet_id:t._leaflet_id}),map.removeLayer(this),r=app.getMarkerTemplate(t,t.options.data.content),t.bindPopup(r).openPopup(),t._popup.options.autoClose=!1,app.ruleGroup.addLayer(t),i=app.ruleGroup.getLayersByType(L.Marker),i.getLayers().length>1){var u=i.getLayers()[i.getLayers().length-2]._latlng,f=i.getLayers()[i.getLayers().length-1]._latlng,e=L.polyline([u,f],{color:"blue",fillOpacity:.7,entityType:"polyline"}).addTo(map);app.ruleGroup.addLayer(e)}}else app.ruleGroup.getLayers().forEach(function(n){app.ruleGroup.removeLayer(n);map.removeLayer(n)})}.bind(n),o.removeEventListener("click",v),o.addEventListener("click",v));r&&(y=function(){app.sendToServer("sendToFileOpen",this)}.bind(n),r.removeEventListener("click",y),r.addEventListener("click",y),$._data(r,"events")===null&&(r.style.color="#cccccc"));i&&(p=function(){app.sendToServer("sendToFolderOpen",this)}.bind(n),i.removeEventListener("click",p),i.addEventListener("click",p),$._data(i,"events")===null&&(i.style.color="#cccccc"))};app.displayPopup=function(n,t){if(n===undefined)return!1;t=t||15;var i,r;if(n instanceof L.Layer)i=n,r=new L.LatLng(i.feature.properties.data.Lat,i.feature.properties.data.Lng);else if(n instanceof L.LatLng)r=n;else return!1;map.setView(r,t);i?(i._popup.options.autoClose=!1,i.setStyle({fillColor:"yellow"}),i.openPopup(),app.addMarkerEventClickHandler(i)):map.createGeocoderPopup(r);app.streetView.load(r)};app.export=function(){var n=app.dynamiclayers.drawnItems.toGeoJSON(),t="text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(n));document.getElementById("export").setAttribute("href","data:"+t);document.getElementById("export").setAttribute("download","drawnItems.geojson")};app.streetView=function(){var n=new L.LatLng(32.10778,34.96604),t,i=function(){$("#pano").show();$(".gmnoprint :not(.gm-compass), .gm-style-cc :not(.gm-compass)").css("opacity","0.5").css("font-size","9px");t||app.streetView.load(n);t&&t.setVisible(!0)},r=function(i){if(i!==undefined&&(n=i),!window.google)return!1;gmap=new google.maps.Map(document.getElementById("map"),{center:{lat:n.lat,lng:n.lng},zoom:14});t=new google.maps.StreetViewPanorama(document.getElementById("pano"),{position:{lat:n.lat,lng:n.lng},pov:{heading:34,pitch:10}});gmap.setStreetView(t);gmap.addListener("resize",function(){});google.maps.event.trigger(gmap,"resize")},u=function(n,t){var i=new google.maps.LatLng(n,t),f={zoom:8,center:i,mapTypeId:google.maps.MapTypeId.ROADMAP},r=new google.maps.Map(document.getElementById("pano"),f),u=new google.maps.Marker({position:i,map:r,title:"marker"}),e=new google.maps.InfoWindow({content:"<B>Skyway Dr<\/B>"});google.maps.event.addListener(u,"click",function(){e.open(r,u)})};return{load:r,refresh:i,lat:function(){return latCurrent},lng:function(){return lngCurrent}}}();templateCompileController.$inject=["$scope","$compile"];
