JSITM={};JSITM.LatLng=function(n,t,i,r){this.lat=n;this.lng=t;this.alt=i||0;this.precision=r||5};JSITM.LatLng.prototype.toString=function(){function n(n,t){var i=Math.pow(10,t||0);return Math.round(n*i)/i}return n(this.lat,this.precision)+" "+n(this.lng,this.precision)};JSITM.LatLng.prototype.convertGrid=function(n,t,i){var r=n.latLngToPoint(this,0),u=i.translate(r);return t.pointToLatLng(u)};JSITM.latlngFromString=function(n){var u=new RegExp("^(-?\\d+(?:\\.\\d*)?)(?:(?:\\s*[:,]?\\s*)|\\s+)(-?\\d+(?:\\.\\d*)?)$","i"),t=n.match(u),i,r;if(t)return i=parseFloat(t[1],10),r=parseFloat(t[2],10),new JSITM.LatLng(i,r);throw"could not parse latlng";};JSITM.Point=function(n,t,i){this.y=t;this.x=n;this.z=i||0};JSITM.Point.prototype.toString=function(){return Math.round(this.x)+" "+Math.round(this.y)};JSITM.Translation=function(n,t,i){this.dx=n;this.dy=t;this.dz=i};JSITM.Translation.prototype.translate=function(n){return new JSITM.Point(n.x+this.dx,n.y+this.dy,n.z+this.dz)};JSITM.Translation.prototype.inverse=function(){return new JSITM.Translation(-this.dx,-this.dy,-this.dz)};JSITM.Ellipsoid=function(n,t){this.a=n;this.b=t;this.e2=(Math.pow(n,2)-Math.pow(t,2))/Math.pow(n,2)};JSITM.Ellipsoid.prototype.pointToLatLng=function(n){var r=Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2)),t=Math.atan2(n.z,r*(1-this.e2)),u,i,f,e;do if(u=this.a/Math.sqrt(1-this.e2*Math.pow(Math.sin(t),2)),i=Math.atan2(n.z+this.e2*u*Math.sin(t),r),Math.abs(t-i)>1e-9)t=i;else break;while(1);return f=i*(180/Math.PI),e=Math.atan2(n.y,n.x)*(180/Math.PI),new JSITM.LatLng(f,e)};JSITM.Ellipsoid.prototype.latLngToPoint=function(n){var t=n.lat*(Math.PI/180),r=n.lng*(Math.PI/180),i=this.a/Math.sqrt(1-this.e2*Math.pow(Math.sin(t),2)),u=(i+n.alt)*Math.cos(t)*Math.cos(r),f=(i+n.alt)*Math.cos(t)*Math.sin(r),e=(i*(1-this.e2)+n.alt)*Math.sin(t);return new JSITM.Point(u,f,e)};JSITM.TM=function(n,t,i,r,u,f){this.ellipsoid=n;this.e0=t;this.n0=i;this.f0=r;this.lat0=u;this.lng0=f;this.radlat0=u*(Math.PI/180);this.radlng0=f*(Math.PI/180);this.af0=n.a*r;this.bf0=n.b*r;this.e2=(Math.pow(this.af0,2)-Math.pow(this.bf0,2))/Math.pow(this.af0,2);this.n=(this.af0-this.bf0)/(this.af0+this.bf0);this.n2=this.n*this.n;this.n3=this.n2*this.n};JSITM.TM.prototype.Marc=function(n){return this.bf0*((1+this.n+5/4*this.n2+5/4*this.n3)*(n-this.radlat0)-(3*this.n+3*this.n2+21/8*this.n3)*Math.sin(n-this.radlat0)*Math.cos(n+this.radlat0)+(15/8*this.n2+15/8*this.n3)*Math.sin(2*(n-this.radlat0))*Math.cos(2*(n+this.radlat0))-35/24*this.n3*Math.sin(3*(n-this.radlat0))*Math.cos(3*(n+this.radlat0)))};JSITM.TM.prototype.InitialLat=function(n){for(var t=(n-this.n0)/this.af0+this.radlat0,i=this.Marc(t),r=(n-this.n0-i)/this.af0+t;Math.abs(n-this.n0-i)>1e-5;)r=(n-this.n0-i)/this.af0+t,i=this.Marc(r),t=r;return r};JSITM.TM.prototype.unproject=function(n){var r=n.x-this.e0,t=this.InitialLat(n.y),i=this.af0/Math.sqrt(1-this.e2*Math.pow(Math.sin(t),2)),u=i*(1-this.e2)/(1-this.e2*Math.pow(Math.sin(t),2)),f=i/u-1,e=Math.tan(t)/(2*u*i),o=Math.tan(t)/(24*u*Math.pow(i,3))*(5+3*Math.pow(Math.tan(t),2)+f-9*f*Math.pow(Math.tan(t),2)),s=Math.tan(t)/(720*u*Math.pow(i,5))*(61+90*Math.pow(Math.tan(t),2)+45*Math.pow(Math.tan(t),4)),h=180/Math.PI*(t-Math.pow(r,2)*e+Math.pow(r,4)*o-Math.pow(r,6)*s),c=Math.pow(Math.cos(t),-1)/i,l=Math.pow(Math.cos(t),-1)/(6*Math.pow(i,3))*(i/u+2*Math.pow(Math.tan(t),2)),a=Math.pow(Math.cos(t),-1)/(120*Math.pow(i,5))*(5+28*Math.pow(Math.tan(t),2)+24*Math.pow(Math.tan(t),4)),v=Math.pow(Math.cos(t),-1)/(5040*Math.pow(i,7))*(61+662*Math.pow(Math.tan(t),2)+1320*Math.pow(Math.tan(t),4)+720*Math.pow(Math.tan(t),6)),y=180/Math.PI*(this.radlng0+r*c-Math.pow(r,3)*l+Math.pow(r,5)*a-Math.pow(r,7)*v);return new JSITM.LatLng(h,y)};JSITM.TM.prototype.project=function(n){var t=n.lat*(Math.PI/180),e=n.lng*(Math.PI/180),i=this.af0/Math.sqrt(1-this.e2*Math.pow(Math.sin(t),2)),f=i*(1-this.e2)/(1-this.e2*Math.pow(Math.sin(t),2)),u=i/f-1,r=e-this.radlng0,o=this.Marc(t),s=o+this.n0,h=i/2*Math.sin(t)*Math.cos(t),c=i/24*Math.sin(t)*Math.pow(Math.cos(t),3)*(5-Math.pow(Math.tan(t),2)+9*u),l=i/720*Math.sin(t)*Math.pow(Math.cos(t),5)*(61-58*Math.pow(Math.tan(t),2)+Math.pow(Math.tan(t),4)),a=s+Math.pow(r,2)*h+Math.pow(r,4)*c+Math.pow(r,6)*l,v=i*Math.cos(t),y=i/6*Math.pow(Math.cos(t),3)*(i/f-Math.pow(Math.tan(t),2)),p=i/120*Math.pow(Math.cos(t),5)*(5-18*Math.pow(Math.tan(t),2)+Math.pow(Math.tan(t),4)+14*u-58*Math.pow(Math.tan(t),2)*u),w=this.e0+r*v+Math.pow(r,3)*y+Math.pow(r,5)*p;return new JSITM.Point(w,a,0)};JSITM.GRS80=new JSITM.Ellipsoid(6378137,6356752.31414);JSITM.WGS84=new JSITM.Ellipsoid(6378137,6356752.314245);JSITM.GRS80toWGS84=new JSITM.Translation(-48,55,52);JSITM.WGS84toGRS80=JSITM.GRS80toWGS84.inverse();JSITM.ITM=new JSITM.TM(JSITM.GRS80,219529.584,626907.38999,1.0000067,31.734394,35.204517);JSITM.point2ItmRef=function(n,t){function r(n,t){for(var i=new String(n);i.length<t;)i="0"+i;return i}var i=t||6;i<3&&(i=3);i>6&&(i=6);var u=Math.pow(10,6-i),f=Math.round(n.x/u),e=Math.round(n.y/u);return r(f,i)+" "+r(e,i)};JSITM.itmRef2Point=function(n){for(var r,i,t=6;t>=3;t--)if(r=new RegExp("^(\\d{"+t+"})\\s*:?\\s*(\\d{"+t+"})$","i"),i=n.match(r),i&&t>0){var u=Math.pow(10,6-t),f=parseInt(i[1],10)*u,e=parseInt(i[2],10)*u;return new JSITM.Point(f,e)}throw"Could not parse reference";};JSITM.itm2gps=function(n){var t=this.ITM.unproject(n);return t.convertGrid(this.GRS80,this.WGS84,this.GRS80toWGS84)};JSITM.gps2itm=function(n){var t=n.convertGrid(this.WGS84,this.GRS80,this.WGS84toGRS80);return this.ITM.project(t)};JSITM.itmRef2gps=function(n){var t=this.itmRef2Point(n);return this.itm2gps(t)};JSITM.itmRef2gpsRef=function(n){return this.itmRef2gps(n).toString()};JSITM.gpsRef2itm=function(n){var t=this.latlngFromString(n);return this.gps2itm(t)};JSITM.gpsRef2itmRef=function(n,t){return this.point2ItmRef(this.gpsRef2itm(n),t||6)};